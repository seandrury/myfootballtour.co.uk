{% set query = query ?? '' %}
{% set page = page ?? 1 %}
{% set league = league ?? '' %}

{% set leagues = craft.app.fields.getFieldByHandle('league').options %}
{% set stadiums = craft.entries.section('stadiums').league(league).orderBy("team ASC").search(query) %}

{% set entryQuery = stadiums.limit(limit) %}

{# Paginates the entry query given the current page #}
{% set pageInfo = sprig.paginate(entryQuery, page) %}
{% set entries = pageInfo.pageResults %}

{% set photo = {
    mode: 'crop',
    width: 480,
    height: 360,
    quality: 80,
    position: 'center-center'
} %}

<form id="stadium-filters">
    <div class="row">
        {# <div class="float-right">
            <div class="labelled-switch d-flex flex-row align-items-center justify-content-end toggle-view m-3">
                <p class="mb-0">Stadiums</p>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
                <p class="mb-0">Teams</p>
            </div>
        </div> #}
        <div class="d-flex justify-content-between align-items-center">
            <div class="form-control position-relative w-50">
                <input sprig s-trigger="keyup changed delay:200ms" s-replace="#results" class="w-100" type="text" name="query" value="{{ query }}" placeholder="Search" autocomplete="off">
                <span class="search">
                    {% include "_svg/search-icon.svg" %}
                </span>
            </div>
            <div>
            <div class="form-control position-relative">
                <select sprig s-replace="#results" name="league" value="{{ league }}" placeholder="Search" autocomplete="off">
                    {% for option in leagues %}
                        <option value="{{ option.value }}">{{ option.label }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
</form>

{# <p class="mb-0 mt-5">Showing {{ pageInfo.first }} &ndash; {{ pageInfo.last }} of {{ pageInfo.total }} entries.</p> #}

<div class="view stadiums-view">
    <div id="results">
        {% if stadiums|length > 0 %}
        <div class="grid stadium-list my-5" id="stadium-list">
            
            {% for stadium in entries %}
                {% set image = stadium.gallery[0] ?? defaultImages.mainStadiumImage[0] ?? null %}
                
                <div class="g-col-12 g-col-md-6">
                    <div class="card position-relative">
                        <figure class="mb-0">
                            <img src="{{ image.getUrl(photo) }}" class="img-fluid">
                            <a href="{{ stadium.url }}" class="stretched-link" aria-label="{{ stadium.title }}">
                            <figcaption class="position-absolute w-100">
                                <p class="h5 stretched-link">{{ stadium.title }}</p>
                                <p class="mb-0">{{ stadium.team }}</p>
                            </figcaption>
                            </a>
                        </figure>
                    </div>
                </div>
            {% endfor %}
        </div>

        {% else %}
            <p class="mt-3 fs-3 text-center ">No teams or stadiums match your search query. Please try another.</p>
        {% endif %}

        {# <div class="grid team-list my-5" id="team-list" style="gap: 20px">
            {% for team in stadiums %}
                {% set colour = team.teamColour[0].slug %}
                {% set league = team.league %}

                <div class="team-card {{ league|kebab }} team-{{ team.id }} team-{{ colour }} bg-white position-relative d-flex">
                    <div class="d-flex flex-row w-100">
                        <div class="team-info p-4 w-100 d-flex align-items-center">
                            <div class="text">
                                <a class="stretched-link h5 mb-0" id="pin-{{ team.id }}" href="#region-map">{{ team.team }}</a>
                                <p class="mb-0">{{ team.title }}</p>
                            </div>
                        </div>
                        <div class="team-logo p-3 my-auto">
                            <img src="{{ team.badge[0].getUrl('clubCrest') ?? '' }}" class="img-fluid">
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div> #}

        {% if pageInfo.totalPages > 1 %}
            <nav style="gap: 16px">
                <ol class="pagination justify-content-center align-items-center">
                    {% for i in 1..pageInfo.totalPages %}
                        <li><button sprig class="{% if i == page %}active{% endif %}" s-val:page="{{ i }}" s-val:league="{{ league }}" s-push-url="?page={{ i }}">{{ i }}</button></li>
                    {% endfor %}
                </ol>
            </nav>
        {% endif %}
    </div>
</div>