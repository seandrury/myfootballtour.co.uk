{% set query = query ?? '' %}
{% set page = page ?? 1 %}

{% set leagues = craft.app.fields.getFieldByHandle('league').options %}
{% set stadiums = craft.entries.section('stadiums').orderBy("team ASC").search(query) %}

{% set entryQuery = stadiums.limit(limit) %}

{# Paginates the entry query given the current page #}
{% set pageInfo = sprig.paginate(entryQuery, page) %}
{% set entries = pageInfo.pageResults %}

{% set photo = {
    mode: 'crop',
    width: 480,
    height: 360,
    quality: 80,
    position: 'center-center'
} %}

<form sprig id="stadium-filters">
    <div class="row mb-large">
    {% for option in leagues %}
        {% if option.value != '' %}
            <div class="col-md-6">
                <label class="form-control d-flex align-items-center">
                    <input type="checkbox" name="{{ option.value }}" id="{{ option.value }}" checked />{{ option.label }}
                </label>
            </div>
        {% endif %}
    {% endfor %}
    </div>
    <div class="row">
        <div class="d-flex justify-content-between align-items-center">
            <div class="form-control position-relative w-50">
                <input sprig s-trigger="keyup changed delay:200ms" s-replace="#results" class="w-100" type="text" name="query" value="{{ query }}" placeholder="Search">
                <span class="search">
                    {% include "_svg/search-icon.svg" %}
                </span>
            </div>
            <div class="labelled-switch d-flex flex-row align-items-center justify-content-end toggle-view">
                <p class="mb-0">Teams</p>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
                <p class="mb-0">Stadiums</p>
            </div>
        </div>
    </div>
</form>

{# <p class="mb-0 mt-5">Showing {{ pageInfo.first }} &ndash; {{ pageInfo.last }} of {{ pageInfo.total }} entries.</p> #}

<div class="grid related-stadiums my-5">
    {% for stadium in entries %}
        {% set image = stadium.gallery[0] ?? defaultImages.mainStadiumImage[0] ?? null %}
        
        <div class="g-col-12 g-col-md-6">
            <div class="card position-relative">
                <figure class="mb-0">
                    <img src="{{ image.getUrl(photo) }}" class="img-fluid">
                    <a href="{{ stadium.url }}" class="stretched-link" aria-label="{{ stadium.title }}">
                    <figcaption class="position-absolute w-100">
                        <p class="h5 stretched-link">{{ stadium.title }}</p>
                        <p class="mb-0">{{ stadium.team }}</p>
                    </figcaption>
                    </a>
                </figure>
            </div>
        </div>
    {% endfor %}
</div>

{% if entries %}
    <nav style="gap: 16px">
        <ol class="pagination justify-content-center align-items-center">
            {% for i in 1..pageInfo.totalPages %}
                <li><button sprig class="{% if i == page %}active{% endif %}" s-val:page="{{ i }}" s-push-url="?page={{ i }}">{{ i }}</button></li>
            {% endfor %}
        </ol>
    </nav>
{% endif %}